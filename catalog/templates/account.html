{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Мой аккаунт — TIMEPIECE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  </head>

  <body>
    {% comment %} Это Django-шаблон (Render). Каталог/корзина у вас на Vercel —
    ссылки ведём на frontend-домен. {% endcomment %} {% with
    FRONTEND_BASE="https://x-frontend-xi.vercel.app" %}
    <header class="header glass-panel">
      <div class="container header-inner">
        <a href="{{ FRONTEND_BASE }}/index.html" class="logo">TIMEPIECE</a>

        <nav class="nav">
          <a href="{{ FRONTEND_BASE }}/catalog.html">Каталог</a>
          <a href="{{ FRONTEND_BASE }}/cart.html">Корзина</a>
        </nav>

        <div class="auth-links">
          {% if user.is_authenticated %}
          <span class="mono" style="margin-right: 16px"
            >{{ user.username }}</span
          >
          <a href="{% url 'logout' %}">Выйти</a>
          {% else %}
          <a href="{% url 'login' %}">Войти</a>
          <a href="/signup/">Регистрация</a>
          {% endif %}
        </div>
      </div>
    </header>

    <main class="section">
      <div class="container">
        <div class="glass-panel" style="padding: 32px">
          <h1 class="section-title">Мой аккаунт</h1>

          {% if user.is_authenticated %}
          <p><strong>Логин:</strong> {{ user.username }}</p>

          {# безопасно получаем профиль, даже если его нет #} {% with
          profile=user|attr:"profile" %} {% if profile %} {% if profile.phone %}
          <p><strong>Телефон:</strong> {{ profile.phone }}</p>
          {% endif %} {% if profile.location %}
          <p><strong>Локация:</strong> {{ profile.location }}</p>
          {% endif %} {% else %}
          <p style="opacity: 0.7">Профиль пользователя не заполнен</p>
          {% endif %} {% endwith %}

          <h2 class="section-title" style="margin-top: 24px">Мои заказы</h2>

          {% if orders %}
          <ul class="order-list">
            {% for order in orders %}
            <li
              class="order-item glass-panel"
              style="margin: 12px 0; padding: 16px"
            >
              <p>
                <strong>Заказ #{{ order.id }}</strong> —
                <span class="order-status"
                  >Статус: {{ order.get_status_display }}</span
                >
              </p>

              <p>Создан: {{ order.created_at }}</p>
              <p>Адрес: {{ order.location }}</p>
              <p>Телефон: {{ order.phone }}</p>
              <p>Сумма: {{ order.total_amount }} сум</p>

              {% with items=order.items.all %} {% if items %}
              <div class="order-products" style="margin-top: 14px">
                <p style="margin-bottom: 10px"><strong>Товары:</strong></p>

                {% for item in items %}
                <div
                  style="
                    display: flex;
                    gap: 12px;
                    align-items: center;
                    margin: 10px 0;
                  "
                >
                  {% if item.watch and item.watch.image %}
                  <img
                    src="{{ item.watch.image.url }}"
                    alt="{{ item.watch.name }}"
                    style="
                      width: 64px;
                      height: 64px;
                      object-fit: cover;
                      border-radius: 10px;
                    "
                  />
                  {% else %}
                  <div
                    style="
                      width: 64px;
                      height: 64px;
                      background: #eee;
                      border-radius: 10px;
                    "
                  ></div>
                  {% endif %}

                  <div>
                    <div>
                      <strong>{{ item.watch.name|default:"Товар" }}</strong>
                    </div>
                    <div style="font-size: 14px; opacity: 0.8">
                      {{ item.quantity }} шт · {{ item.price }} {{
                      item.watch.currency }}
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% endif %} {% endwith %}
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>У вас пока нет заказов.</p>
          {% endif %} {% else %}
          <p>Сначала войдите в аккаунт.</p>
          <p><a href="/accounts/login/">Перейти к входу</a></p>
          {% endif %}
        </div>
      </div>
    </main>
    {% endwith %}
  </body>
</html>
